Arquivo,Modelo,Analise
pipes/assistant-ui-ollama-openai-screenpipe/app/api/chat/route.ts,FLAN-T5,"import  openai  from ""@ai-sdk/openai""; import  jsonSchema, streamText  from ""ai""; import  ollama  from ""ollama-ai-provider""; import  pipe  from ""@screenpipe/js""; import  NextResponse  from ""next/server""; export const runtime = ""edge""; export const maxDuration = 30; export async function POST(req: Request)  const  messages, system, tools  = await req.json(); const settings = await pipe.settings.getAll(); const aiPreset = settings.aiPresets?.find((preset) => preset.defaultPreset); console.log(""aiPreset"", aiPreset); check if aiPreset is correct if (!aiPreset)  return NextResponse.json( error: ""no api key found for openai"" ,  status: 400 );  check if aiPreset is correct eg api key if openai or screenpipe-cloud  if (aiPreset.provider == ""openai"" && !aiPreset.apiKey)  return NextResponse.json(  error: ""no api key found for openai"" ,  status: 400 );  const model = aiPreset.provider == ""openai"" ? openai(aiPreset.model) : aiPreset.provider == ""native-ollama"" ? ollama(aiPreset.model) : openai(aiPreset.model); const result = streamText( model, messages, forward system prompt and tools from the frontend system, tools: Object.fromEntries(Object.entries parameters: unknown >(tools).map("
pipes/assistant-ui-ollama-openai-screenpipe/app/api/click-by-index/route.ts,FLAN-T5,"/* curl -X POST ""http://localhost:3000/api/click-by-index""  -H ""Content-Type: application/json""  -d '""element_index: 2' | jq */ import  NextResponse  from ""next/server""; import  pipe as browserPipe  from ""../../../../screenpipe-js/browser-sdk/dist""; export async function POST(request: Request)  try  parse the JSON body const body = await request.json(); const index = body.element_index; if (index == undefined)  return NextResponse.json(  error: ""index == undefined"") ,  status: 400 ;  if (index != 'number')  return NextResponse.json(  error: ""index, success: result, );  try  const result = await browserPipe.operator.clickByIndex(index); console.log(clicked element at index $index); return NextResponse.json( index, success: result, );  catch (clickError)  Safely extract error message as string const errorMessage = clickError instanceof Error ? clickError.message : String(clickError); console.error(Click error: $errorMessage); Preserve HTTP status if possible const statusCode = (clickError as any).status || 500; return NextResponse.json(  error: errorMessage ,  status: statusCode );   catch (err) "
pipes/assistant-ui-ollama-openai-screenpipe/app/api/component-source/route.ts,FLAN-T5,"import NextResponse  from 'next/server'; import fs from 'fs/promises'; import path from 'path'; export async function GET(request: Request)  try  get the URL and extract the path parameter const  searchParams  URL = new URL(request.url); const filePath = searchParams.get('path'); console.log(""api: requested component source for path:"", filePath); if (!filePath)  console.log(""api: no path provided""); return NextResponse.json( error: 'no path provided',  status: 400 );  security: Ensure path doesn't try to access files outside the project by normalizing it and checking for path traversal attempts const normalizedPath = path.normalize(filePath); replace(/(..(/||$))+/, ''); resolve the absolute path from the project root const projectRoot = process.cwd(); remove any leading slash and strip out any reference to the project structure. This fixes the duplicate path issue. const cleanPath = normalizedPath; replace(///, ''); .replace(/pipes/example-pipe//, ''); console.log(""api: normalized path:"", normalizedPath); console.log(""api: clean path after stripping prefix:"", cleanPath); const absolutePath = path.join(projectRoot, cleanPath); console.log(""api: attempting to read file at:"", absolutePath); console.log(""api: project root is:"", projectRoot); check if file exists try  await fs.ac ---------------"
pipes/assistant-ui-ollama-openai-screenpipe/app/api/fetch-external/route.ts,FLAN-T5,"import  NextRequest, NextResponse  from ""next/server""; /** * API route to fetch content from external URLs * Used by the playground to fetch documentation and other external resources */ export async function GET(request: NextRequest)  try  Get the URL from the query parameters const url = request.nextUrl.searchParams.get(""url""); console.log(""fetch-external: received request for url:"", url); if (!url)  console.error(""fetch-external: missing url parameter""); return NextResponse.json(  error: ""fetch-external: invalid url format:"", url); return NextResponse.json(  error: ""fetch-external: invalid url format:"", url); return NextResponse.json(  error: ""fetch-external: invalid url format:"", url); const startTime = performance.now(); const response = await; fetch(url,  headers:  ""User-Agent"": ""ScreenPipe-Example-Pipe/1.0""  ); const endTime = performance.now(); if (!response.ok)  console.error(""fetch-external: external request failed with status $response.status); return NextResponse.json(  error: ""fetch-external: external request failed with status $response.status,  status: 502 );  get the content"
pipes/assistant-ui-ollama-openai-screenpipe/app/api/get-interactive-list/route.ts,FLAN-T5,"GET(""http://localhost:3000/api/get-interactive-list?app=Messages&with_text_only=true&include_sometimes_interactable=true""); import  NextResponse  from ""next/server""; import  pipe as browserPipe  from ""../../../screenpipe-js/browser-sdk/dist""; export async function GET(request:Request)  try  Get query parameters const url = new URL(request.url); const app = url.searchParams.get(""app""); const windowName = url.searchParams.get(""window"") || undefined; if (!app)  console.error(""missing required parameter: app""); return NextResponse.json(app);   Boolean parameters - convert string to boolean const withTextOnly = url.searchParams.get(""with_text_only"") == ""true""; const interactableOnly = url.searchParams.get(""interactable_only"") == ""true""; const includeSometimesInteractable = url.searchParams.get(""include_sometimes_interactable"") == ""true""; const activateApp = url.searchParams.get(""activate_app"") === ""true""; const verbose = url.searchParams.get(""verbose"") === ""true""; const maxElements = url.searchParams.get(""max_elements"") ? parseInt(url.searchParams.get(""max_elements"") || """", 10) : undefined; console.log(listing elements for app: $)  "
pipes/assistant-ui-ollama-openai-screenpipe/app/api/get-text/route.ts,FLAN-T5,"/* curl ""http://localhost:3000/api/get_text?app=Messages"" | jq */ import  NextResponse  from ""next/server""; import  pipe as browserPipe  from ""../../../../screenpipe-js/browser-sdk/dist""; export async function GET(request:Request)  try  Get query parameters const url = new URL(request.url); const app = url.searchParams.get(""app""); input validation if (!app)  console.error(""missing required parameter: app""); return NextResponse.json( ,  status: 400 );  console.log(getting text for app: $app); Use the Operator SDK to get text try  const result = await browserPipe.operator.get_text( app: app, ); console.log(got text response, success: $result.success, length: $result.text.length chars); return NextResponse.json( app, success: result.success, text: result.text, metadata: result.metadata, );  catch (textError)  Safely extract error message as string const errorMessage = textError instanceof Error ? textError.message : String(textError); console.error(get_text error: $errorMessage); preserve HTTP status if possible const statusCode = (textError as any).status || 500; return NextResponse.json(  error: errorMessage ,  status: statusCod "
pipes/assistant-ui-ollama-openai-screenpipe/app/api/locator/route.ts,FLAN-T5,"/* curl -X GET ""http://localhost:3000/api/locator?app=Arc&role=AXButton"" */ import  NextResponse  from ""next/server""; import  pipe as browserPipe  from ""../../../../screenpipe-js/browser-sdk/dist""; export async function GET(request:Request)  try  Get query parameters const url = new URL(request.url); const app = url.searchParams.get(""app"") || Chrome; const role = url.searchParams.get(""role"") || ""AXButton""; console.log(searching for $role elements in $app app); Use the Operator SDK to locate UI elements const elements = await browserPipe.operator .locator( app: app, role: role, useBackgroundApps: true, activateApp: false, Default to not activating to avoid disrupting the user ) .all(); console.log(found $elements.length elements); return NextResponse.json( app, role, elementsFound: elements.length, elements, );  catch (error)  console.error(""error accessing ui elements:"", error); return NextResponse.json("
pipes/assistant-ui-ollama-openai-screenpipe/app/api/log/route.ts,FLAN-T5,"import NextResponse  from ""next/server""; import  pipe  from ""@screenpipe/js""; import  pipe as browserPipe, ElementInfo  from ""@screenpipe/browser""; import  join  from ""path""; import fs from ""fs/promises""; import OpenAI from ""openai/index.mjs""; deduplicateByStringSimilarity(texts: ElementInfo[], threshold: number)  const groups:  text: string; similar: string[];  text[] = []; const processed = new Setnumber>(); first remove empty strings and less than 20 characters texts = texts.filter((text) => text.text && text.text !== """" && text.text.length > 20); Simple Jaccard similarity for strings const calculateSimilarity = (str1: string, str2: string) =>  if (str1 == str2) return 1.0; Create sets of words/characters for comparison const set1 = new Set(str1.toLowerCase().split(/s+/)); const set2 = new Set(str2.toLowerCase().split(/s+/)); Calculate intersection and union; const intersection = new Set([...set1].filter((x) => set2.has(x))); const union = new Set([...set1, ...set2]); return intersection.size / union.size; ; Group similar texts for (i = 0; i  texts.length; i++)  if (processed.has(i)) continue; const group =  text: texts[i].text!, similar: texts[i] ; processed.add(i); for (j = 0; j  texts.length; j++)  if (i == j || processed.has(j)) continue; ---------------"
pipes/assistant-ui-ollama-openai-screenpipe/app/api/press-key-by-index/route.ts,FLAN-T5,"/* curl -X POST ""http://localhost:3000/api/press-key-by-index""  -H ""Content-Type: application/json""  -d '""element_index"": 32, ""key_combo"": ""return""'; import  NextResponse  from ""next/server""; import  pipe as browserPipe  from ""../../../../screenpipe-js/browser-sdk/dist""; export async function POST(request: Request)  try  parse the JSON body const body = await request.json(); const index = body.element_index; const keyCombo = body.key_combo; if (index == undefined)  return NextResponse.json(  error: ""element_index is required in request body"" ,  status: 400 );  if (typeof index != 'number')  return NextResponse.json(  error: ""key_combo is required in request body"" ,  status: 400 );  validate key_combo parameter if (!keyCombo)  return NextResponse.json(  error: ""key_combo is required in request body"" ,  status: 400 );  try  call our new pressKeyByIndex method from the SDK const result = await browserPipe.operator.pressKeyByIndex(index, keyCombo); console.log(pressed key combo ""$keyCombo"" on element at index $index); return NextResponse.json(index, key_combo: keyCombo, success: result, result, );  catch (keyPressError)  safely extract error message as string"
pipes/assistant-ui-ollama-openai-screenpipe/app/api/settings/route.ts,FLAN-T5,"GET()  const settingsManager = pipe.settings; if (!settingsManager)  throw new Error(""settingsManager not found"");  get the pipe name from the current file path const currentFilePath = __filename; const pipesIndex = currentFilePath.indexOf('pipes'); const pipeName = currentFilePath.substring(pipesIndex + 6); split(pipe.sep)[0]; console.log(loading settings for pipe: $pipeName); load persisted settings if they exist const screenpipeDir = process.env.SCREENPIPE_DIR || process.cwd(); const settingsPath = path.join(screenpipeDir, ""pipes"", pipeName, ""pipe.json""); try  const settingsContent = await fs.readFile(settingsPath, ""utf8""); const persistedSettings = JSON.parse(settingsContent); console.log(loaded persisted settings from $settingsPath); Merge with current settings const rawSettings = await settingsManager.getAll(); return NextResponse.json( ...rawSettings, customSettings:  ...rawSettings.customSettings, [pipeName]:  ...(rawSettings.customSettings?.[pipeName] || ), ...persistedSettings, , , ); ---------------"
pipes/assistant-ui-ollama-openai-screenpipe/app/api/type-by-index/route.ts,FLAN-T5,"/* curl -X POST ""http://localhost:3000/api/type-by-index""  -H ""Content-Type: application/json""  -d '""element_index: 32, ""text"":""hello world""' | jq */ import  NextResponse  from ""next/server""; import  pipe as browserPipe  from ""../../../../screenpipe-js/browser-sdk/dist""; export async function POST(request: Request)  try  parse the JSON body const body = await request.json(); const index = body.element_index; const text = body.text; if (index == undefined)  return NextResponse.json(  error: ""element_index is required in request body"" ,  status: 400 );  if (index != 'number')  return NextResponse.json(  error: ""element_index must be a valid number"" ,  status: 400 );  validate text parameter if (!text)  return NextResponse.json(  error: ""text is required in request body"" ,  status: 400 );  try  call our new typeByIndex method from the SDK const result = await browserPipe.operator.typeByIndex(index, text); console.log(typed text into element at index $index: ""$text""); return NextResponse.json( index, text, success: result, result, );  catch (typeError)  safely extract error message const errorMessage = typeError instanceof Error ? type"
pipes/assistant-ui-ollama-openai-screenpipe/app/assistant.tsx,FLAN-T5,"; import  AssistantRuntimeProvider  from ""@assistant-ui/react""; import  useChatRuntime  from ""@assistant-ui/react-ai-sdk""; import  Thread  from ""@/components/assistant-ui/thread""; import  ThreadList  from ""@/components/assistant-ui/thread-list""; import  AIPresetsDialog  from ""@/components/ai-presets-dialog""; import  AIPresetsSelector  from ""@/components/ai-presets-selector""; export const Assistant = () =>  const runtime = useChatRuntime( api: ""/api/chat"", ); return (  AssistantRuntimeProvider runtime=runtime> div className=""grid h-dvh grid-cols-[200px_1fr] gap-x-2 px-4 py-4> ThreadList /> Thread /> Thread /> /* AIPresetsDialog pipeName=""hello-world-computer-use"" /> */ AIPresetsSelector pipeName=""hello-world-computer-use"" /> /div> /AssistantRuntimeProvider> ); ; ---------------"
pipes/assistant-ui-ollama-openai-screenpipe/app/hello-world-mcp-client/WIP-interface.ts,FLAN-T5," async startChatLoop(): Promisevoid>  console.log(""desktop control client started""); console.log(""type your queries or 'quit' to exit""); interactive prompt handling logic  "
pipes/assistant-ui-ollama-openai-screenpipe/app/hello-world-mcp-client/WIP-tool-execution-logic.ts,FLAN-T5,"async executeTool(toolName: string, args: any): Promisestring>  console.log(executing tool $toolName with args: $JSON.stringify(args)); const result = await this.session!.callTool(toolName, args); console.log(tool result: $result.substring(0, 100)$result.length > 100 ? '...' : ''); return result; "
